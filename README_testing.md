# 48小时天气预报模型测试指南

## 概述

本测试脚本已更新为支持48小时天气预报，并提供详细的基础模型与DDPG集成模型的性能对比分析。

## 主要更新

### 1. 预测时间扩展
- **从24小时扩展到48小时预测**
- 每6小时一个时间步，共8个时间步
- 更全面的长期天气预报评估

### 2. 增强的评估指标
- **RMSE** (均方根误差)
- **MAE** (平均绝对误差)  
- **相关系数** (预测值与真实值的相关性)
- **MAPE** (平均绝对百分比误差)
- **NRMSE** (标准化均方根误差)

### 3. 详细性能对比
- 基础模型单独预测 vs DDPG集成预测
- 多维度性能指标对比
- 性能提升量化分析

## 使用方法

### 1. 基本模型评估
```bash
# 评估10个回合的48小时预测性能
python src/test_model.py --episodes 10

# 显示详细评估过程
python src/test_model.py --episodes 5 --render

# 保存评估图表
python src/test_model.py --episodes 10 --save_plot results_48h.png
```

### 2. 单回合详细演示
```bash
# 运行单回合48小时预测演示
python src/test_model.py --demo
```

### 3. 基础模型 vs DDPG集成模型对比
```bash
# 运行5个回合的对比分析
python src/test_model.py --compare --compare_episodes 5

# 运行10个回合的详细对比
python src/test_model.py --compare --compare_episodes 10
```

### 4. 完整评估流程
```bash
# 1. 先运行对比分析
python src/test_model.py --compare --compare_episodes 5

# 2. 再运行详细评估
python src/test_model.py --episodes 10 --render --save_plot comprehensive_results.png

# 3. 最后运行单回合演示
python src/test_model.py --demo
```

## 输出说明

### 1. 评估结果表格
```
📊 48小时天气预报模型评估结果
============================================================

🎯 DDPG集成模型性能 (48小时预测):
  平均奖励: -2.3456 ± 0.1234
  平均RMSE: 2.3456 ± 0.1234
  平均MAE:  1.8765 ± 0.0987
  平均相关系数: 0.8765 ± 0.0123
  平均MAPE: 15.67% ± 1.23%
  平均NRMSE: 0.2345 ± 0.0123

🔍 各基础模型性能 (48小时预测):
模型        RMSE        MAE         相关系数    MAPE(%)    NRMSE     
----------------------------------------------------------------------
Pangu6      2.4567±0.1  1.9876±0.1  0.8654±0.0  16.23±1.2  0.2456±0.0
FuXi        2.3456±0.1  1.8765±0.1  0.8765±0.0  15.67±1.1  0.2345±0.0
FengWu      2.5678±0.1  2.0987±0.1  0.8543±0.0  17.45±1.3  0.2567±0.0

📈 DDPG集成模型性能提升:
  RMSE提升: 5.23% (相比最佳单一模型)
  MAE提升:  4.56% (相比最佳单一模型)
  相关系数提升: 2.34% (相比最佳单一模型)
```

### 2. 对比分析结果
```
📊 基础模型 vs DDPG集成模型 - 48小时预测性能对比
================================================================================

模型          RMSE      MAE       相关系数    MAPE(%)    NRMSE     
--------------------------------------------------------------------------------
Pangu6        2.4567    1.9876    0.8654     16.23      0.2456
FuXi          2.3456    1.8765    0.8765     15.67      0.2345
FengWu        2.5678    2.0987    0.8543     17.45      0.2567
--------------------------------------------------------------------------------
DDPG集成       2.2345    1.7890    0.8967     14.89      0.2234

📈 DDPG集成模型性能提升:
  RMSE提升: 4.74% (相比最佳基础模型 FuXi)
  MAE提升:  4.66% (相比最佳基础模型 FuXi)
  相关系数提升: 2.30% (相比最佳基础模型 FuXi)
```

### 3. 可视化图表
- **回合奖励趋势图**: 显示DDPG模型的学习稳定性
- **RMSE对比柱状图**: 直观对比各模型性能
- **多指标雷达图**: 全面展示模型在不同指标上的表现
- **相关系数对比**: 显示预测准确性

## 技术细节

### 预测时间配置
- `PREDICT_TIME = 8`: 8个时间步 (48小时)
- `FORECAST_LEAD_TIME_HOURS = 6`: 每6小时一个时间步
- 总预测时间: 8 × 6 = 48小时

### 评估指标计算
- 所有指标基于48小时预测结果计算
- 支持多变量天气数据 (t850, z500, v925, u850)
- 考虑空间和时间维度的完整评估

### 性能提升计算
- 与最佳基础模型对比
- 多维度性能提升分析
- 统计显著性考虑

## 注意事项

1. **计算资源**: 48小时预测需要更多计算资源，建议适当调整评估回合数
2. **内存使用**: 长时间预测可能占用更多内存，注意监控系统资源
3. **模型文件**: 确保训练好的模型文件存在于指定路径
4. **数据依赖**: 需要earth2studio数据源支持

## 故障排除

### 常见问题
1. **模型文件未找到**: 检查`--model_path`参数
2. **内存不足**: 减少`--episodes`或`--compare_episodes`数量
3. **CUDA错误**: 检查GPU内存使用情况

### 性能优化建议
1. 使用GPU加速计算
2. 适当调整批次大小
3. 监控内存使用情况
